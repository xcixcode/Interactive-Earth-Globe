<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Earth Globe</title>
    
    <style>
        /* HTML 및 body 기본 스타일 */
        body { 
            margin: 0; 
            background-color: #000000; /* 검은색 배경 유지 */
            color: white; 
            font-family: sans-serif;
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }
        /* React 애플리케이션 루트 스타일 */
        #root { 
            position: absolute; 
            top: 0;
            left: 0;
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            height: 100%;
            width: 100%;
            pointer-events: none; 
        }
        /* 캔버스를 담을 div */
        .globe-container {
            width: 100%;
            height: 100%;
            pointer-events: auto; 
        }
        /* 정보 표시 영역 */
        .info {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out; 
        }
        /* 숨김 상태 */
        .info.hidden {
            opacity: 0;
            visibility: hidden;
        }
    </style>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/javascript">
        const { useRef, useEffect } = React;
        const EARTH_TEXTURE_URL = 'https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg';

        // 별(Points) 지오메트리를 생성하는 함수
        function createStars() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 10000;
            const positions = new Float32Array(starCount * 3);
            const range = 500; 

            for (let i = 0; i < starCount; i++) {
                // X, Y, Z 좌표를 -range/2 ~ +range/2 범위에서 랜덤하게 설정
                positions[i * 3] = (Math.random() - 0.5) * range;
                positions[i * 3 + 1] = (Math.random() - 0.5) * range;
                positions[i * 3 + 2] = (Math.random() - 0.5) * range;
            }

            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.5,
                sizeAttenuation: true 
            });

            const starField = new THREE.Points(starGeometry, starMaterial);
            return starField;
        }
        
        const EarthGlobe = () => {
            const mountRef = useRef(null);
            
            useEffect(() => {
                const currentMount = mountRef.current;
                if (!currentMount) return;

                let width = window.innerWidth;
                let height = window.innerHeight;

                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000); 
                camera.position.set(2, 0, 15); // 최대 축소 상태로 시작

                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setClearColor(0x000000, 0); 
                renderer.setSize(width, height); 
                const canvas = renderer.domElement;
                currentMount.appendChild(canvas);

                // --- 조명 설정 ---
                const ambientLight = new THREE.AmbientLight(0x444444);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
                directionalLight.position.set(5, 3, 5);
                scene.add(directionalLight);
                
                // 별 배경 추가
                const stars = createStars();
                scene.add(stars); 

                // --- 궤도 컨트롤러 설정 ---
                const controls = new THREE.OrbitControls(camera, canvas);
                controls.enableDamping = true;
                controls.dampingFactor = 0.25;
                controls.minDistance = 2.5; 
                controls.maxDistance = 15;
                
                // 마우스 우클릭(Pan) 기능 비활성화
                controls.mouseButtons = {
                    LEFT: THREE.MOUSE.ROTATE,
                    MIDDLE: THREE.MOUSE.DOLLY,
                    RIGHT: null 
                };

                // --- UI 반응 (info 숨기기) ---
                const infoElement = document.getElementById('info-container');
                
                const handleControlsStart = () => {
                    if (infoElement) {
                        // 조작 시작 시 info 영역 숨기기 (드래그/터치)
                        infoElement.classList.add('hidden');
                    }
                };
                
                const handleWheel = () => {
                    if (infoElement) {
                        // 휠 스크롤 (줌) 시 info 영역 숨기기
                        infoElement.classList.add('hidden');
                    }
                };

                controls.addEventListener('start', handleControlsStart);
                canvas.addEventListener('wheel', handleWheel);

                // --- 텍스처 로더 및 지구 생성 ---
                const textureLoader = new THREE.TextureLoader();
                
                textureLoader.load(EARTH_TEXTURE_URL, (texture) => {
                    
                    const material = new THREE.MeshPhongMaterial({
                        map: texture,
                        specular: 0x333333, 
                        shininess: 15,
                    });

                    const geometry = new THREE.SphereGeometry(2, 64, 64);
                    const earthMesh = new THREE.Mesh(geometry, material);
                    
                    const inclination = 23.5 * Math.PI / 180;
                    earthMesh.rotation.x = inclination;
                    
                    scene.add(earthMesh);
                });
                
                // --- 반응형 처리 함수 ---
                const onWindowResize = () => {
                    width = window.innerWidth;
                    height = window.innerHeight;
                    
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();

                    renderer.setSize(width, height);
                };

                window.addEventListener('resize', onWindowResize);

                // --- 애니메이션 루프 ---
                const animate = () => {
                    requestAnimationFrame(animate);

                    const earthMesh = scene.children.find(child => child.isMesh && child.geometry.type === 'SphereGeometry');
                    if (earthMesh) {
                        earthMesh.rotation.y += 0.0025; /* 자전 속도 (느리게 설정) */
                    }
                    
                    stars.rotation.y += 0.0001; /* 별 배경 느리게 회전 */
                    
                    controls.update();
                    renderer.render(scene, camera);
                };

                animate();
                
                // --- 컴포넌트 정리 (Cleanup) ---
                return () => {
                    window.removeEventListener('resize', onWindowResize);
                    controls.removeEventListener('start', handleControlsStart);
                    canvas.removeEventListener('wheel', handleWheel);
                    
                    if (currentMount && renderer.domElement) {
                        currentMount.removeChild(renderer.domElement);
                    }
                };
            }, []);

            return (
                React.createElement('div', { className: "globe-container", ref: mountRef })
            );
        };

        const App = () => {
            return (
                React.createElement(React.Fragment, null,
                    React.createElement('div', { className: "info", id: "info-container" },
                        React.createElement('h1', null, 'Interactive Earth Globe'),
                        React.createElement('p', null, 'Drag to rotate, scroll to zoom.')
                    ),
                    React.createElement(EarthGlobe, null)
                )
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(App, null));
    </script>
</body>
</html>